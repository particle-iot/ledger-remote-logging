<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "https://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml" lang="en-US">
<head>
<meta http-equiv="Content-Type" content="text/xhtml;charset=UTF-8"/>
<meta http-equiv="X-UA-Compatible" content="IE=11"/>
<meta name="generator" content="Doxygen 1.10.0"/>
<meta name="viewport" content="width=device-width, initial-scale=1"/>
<title>DeviceInfoLedger: DeviceInfoLedger</title>
<link href="tabs.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="jquery.js"></script>
<script type="text/javascript" src="dynsections.js"></script>
<script type="text/javascript" src="clipboard.js"></script>
<script type="text/javascript" src="cookie.js"></script>
<link href="search/search.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="search/searchdata.js"></script>
<script type="text/javascript" src="search/search.js"></script>
<link href="doxygen.css" rel="stylesheet" type="text/css" />
</head>
<body>
<div id="top"><!-- do not remove this div, it is closed by doxygen! -->
<div id="titlearea">
<table cellspacing="0" cellpadding="0">
 <tbody>
 <tr id="projectrow">
  <td id="projectalign">
   <div id="projectname">DeviceInfoLedger
   </div>
  </td>
 </tr>
 </tbody>
</table>
</div>
<!-- end header part -->
<!-- Generated by Doxygen 1.10.0 -->
<script type="text/javascript">
/* @license magnet:?xt=urn:btih:d3d9a9a6595521f9666a5e94cc830dab83b65699&amp;dn=expat.txt MIT */
var searchBox = new SearchBox("searchBox", "search/",'.html');
/* @license-end */
</script>
<script type="text/javascript" src="menudata.js"></script>
<script type="text/javascript" src="menu.js"></script>
<script type="text/javascript">
/* @license magnet:?xt=urn:btih:d3d9a9a6595521f9666a5e94cc830dab83b65699&amp;dn=expat.txt MIT */
$(function() {
  initMenu('',true,false,'search.php','Search');
  $(function() { init_search(); });
});
/* @license-end */
</script>
<div id="main-nav"></div>
</div><!-- top -->
<!-- window showing the filter options -->
<div id="MSearchSelectWindow"
     onmouseover="return searchBox.OnSearchSelectShow()"
     onmouseout="return searchBox.OnSearchSelectHide()"
     onkeydown="return searchBox.OnSearchSelectKey(event)">
</div>

<!-- iframe showing the search results (closed by default) -->
<div id="MSearchResultsWindow">
<div id="MSearchResults">
<div class="SRPage">
<div id="SRIndex">
<div id="SRResults"></div>
<div class="SRStatus" id="Loading">Loading...</div>
<div class="SRStatus" id="Searching">Searching...</div>
<div class="SRStatus" id="NoMatches">No Matches</div>
</div>
</div>
</div>
</div>

<div><div class="header">
  <div class="headertitle"><div class="title"><a class="el" href="class_device_info_ledger.html">DeviceInfoLedger</a> </div></div>
</div><!--header-->
<div class="contents">
<div class="textblock"><p><a class="anchor" id="md__r_e_a_d_m_e"></a> This library perform two separate but related things using two separate classes:</p>
<ul>
<li>Store cloud-based configuration for devices (<a class="el" href="class_device_config_ledger.html">DeviceConfigLedger</a>)</li>
<li>Store Particle device log data and device information in Ledger (<a class="el" href="class_device_info_ledger.html">DeviceInfoLedger</a>)</li>
</ul>
<p>You can use the cloud-based configuration without using the <a class="el" href="class_device_info_ledger.html">DeviceInfoLedger</a>, if desired. You can also use the <a class="el" href="class_device_info_ledger.html">DeviceInfoLedger</a> with a local configuration, not using the remote configuration option.</p>
<h1>Configuration</h1>
<p>This library supports three levels of configuration, all of which are optional:</p>
<ul>
<li>Local (on-device) configuration</li>
<li>Product, owner, or organization cloud-to-device ledger</li>
<li>Device-specific cloud-to-device ledger</li>
</ul>
<p>Using Ledger, this library supports a default configuration using a cloud-to-device ledger (scoped to a product, owner, or organization). This is good for making settings cloud-based instead of on-device, so you can change fleet settings without having to update code.</p>
<p>It also supports an optional per-device configuration using a cloud-to-device device ledger (scoped to a device). The per-device configuration overrides specific values, making it easy to just change one setting and leave the others as the default values.</p>
<p>Configuration support key (string) and value pairs, using types that can be represented in JSON and <code>Variant</code> including:</p>
<ul>
<li>boolean values (<code>bool</code> in C++)</li>
<li>integer number values (<code>int</code>, <code>unsigned</code>, <code>int64_t</code>, <code>uint64_t</code>)</li>
<li>floating point number values (<code>double</code>)</li>
<li>string values (<code>String</code>)</li>
</ul>
<p>For example say this is the product default configuration:</p>
<div class="fragment"><div class="line">{</div>
<div class="line">    &quot;a&quot;: 123,</div>
<div class="line">    &quot;b&quot;: false,</div>
<div class="line">    &quot;c&quot;: &quot;test&quot;</div>
<div class="line">}</div>
</div><!-- fragment --><p>If you set the device configuration to, the value of <code>b</code> will be overridden but the values of <code>a</code> and <code>c</code> will remain the product default.</p>
<div class="fragment"><div class="line">{</div>
<div class="line">    &quot;b&quot;: true</div>
<div class="line">}</div>
</div><!-- fragment --><p>Additionally, the top level can also include one-level deep of object and array types.</p>
<p>When an object is contained in the configuration, all values for the same key are merged so you can easily override specific sub-keys. With this product/owner/organization setting:</p>
<div class="fragment"><div class="line">{</div>
<div class="line">    &quot;x&quot;: {</div>
<div class="line">        &quot;a&quot;: 123,</div>
<div class="line">        &quot;b&quot;: false,</div>
<div class="line">        &quot;c&quot;: &quot;test&quot;</div>
<div class="line">    }</div>
<div class="line">}</div>
</div><!-- fragment --><p>And this per-device setting:</p>
<div class="fragment"><div class="line">{</div>
<div class="line">    &quot;x&quot;: {</div>
<div class="line">        &quot;a&quot;: 456,</div>
<div class="line">        &quot;d&quot;: 789</div>
<div class="line">    }</div>
<div class="line">}</div>
</div><!-- fragment --><p>The configuration will act as follows:</p>
<div class="fragment"><div class="line">{</div>
<div class="line">    &quot;x&quot;: {</div>
<div class="line">        &quot;a&quot;: 456,</div>
<div class="line">        &quot;b&quot;: false,</div>
<div class="line">        &quot;c&quot;: &quot;test&quot;,</div>
<div class="line">        &quot;d&quot;: 789</div>
<div class="line">    }</div>
<div class="line">}</div>
</div><!-- fragment --><p>When an array is contained in the configuration, all array values for the key are appended. For example:</p>
<div class="fragment"><div class="line">{</div>
<div class="line">    &quot;a&quot;: [1, 2]</div>
<div class="line">}</div>
</div><!-- fragment --><p>With a device-specific override:</p>
<div class="fragment"><div class="line">{</div>
<div class="line">    &quot;a&quot;: [2, 3]</div>
<div class="line">}</div>
</div><!-- fragment --><p>The values are all appended in the order local, product/owner/organization, device. Duplicates are not removed!</p>
<div class="fragment"><div class="line">{</div>
<div class="line">    &quot;a&quot;: [1, 2, 2, 3]</div>
<div class="line">}</div>
</div><!-- fragment --><p>Note that only one level of nested object or array is supported! If you nest two objects, the inner objects are not merged and will simply be replaced like a primitive value.</p>
<p>Using cloud-based configuration is optional if you only want to use device log data and device information. These settings can be configured locally on device, if desired. However, you may want to use both so you can control the log settings remotely from the cloud-side.</p>
<h1>Device information ledger</h1>
<p>The following JSON structure is used for default cloud configuration, and device-specific overrides, if those features are enabled.</p>
<div class="fragment"><div class="line">{</div>
<div class="line">    &quot;lastRunLog&quot;: 1024,</div>
<div class="line">    &quot;connectionLog&quot;: 2048,</div>
<div class="line">    &quot;logAllConnections&quot;: false,</div>
<div class="line">    &quot;includeGeneral&quot;: true,</div>
<div class="line">    &quot;includeDiag&quot;: true,</div>
<div class="line">    &quot;includeTower&quot;: true,</div>
<div class="line">    &quot;logLevel&quot;: &quot;INFO&quot;,</div>
<div class="line">    &quot;logFilters&quot;: [],</div>
<div class="line">}</div>
</div><!-- fragment --><p>Cloud-based device overrides can specify only the fields that need to be changed from the default configuration.</p>
<p>You can also set the settings locally, as a default, or in lieu of the cloud configuration. Local settings for device information ledger can be done using JSON, or by calling individual methods like <code>withLastRunLog()</code>.</p>
<h2>Detailed description of fields</h2>
<h3>lastRunLog (int)</h3>
<p>The last run log is the latest log messages prior to the most recent reboot. This can be useful for troubleshooting device resets.</p>
<p>Value is the size of the text to include in the ledger. Must fit within the available space in the ledger, which is up to 16K but can be lower on some platforms.</p>
<p>The last run log is stored in retained memory. This is specified in the application source because it's allocated by the compiler, so the actual run log will be the lesser of lastRunLog and the value stored in the source.</p>
<p>On RTL872x devices (P2, Photon 2, M-SoM), the most recent log entries may not be available if a system panic has occurred.</p>
<h3>connectionLog (int)</h3>
<p>The connection log is the most recent messages from boot until successfully cloud connected on the first connection after reboot (default) or after every cloud disconnect (if logAllConnections is true). Note that logging every disconnection may result in a large number of ledger synchronization is the device is frequently disconnecting from the cloud.</p>
<h3>logAllConnections (bool)</h3>
<h3>includeGeneral (bool)</h3>
<p>Include general information. Default: false.</p>
<p>This currently only includes <code>sysver</code>, the Device OS version.</p>
<h3>includeDiag (bool)</h3>
<p>Include the device vitals information in ledger. Default: false</p>
<h3>includeTower (bool)</h3>
<p>Includes cellular tower information for the connected tower. Default: false</p>
<p>This is stored in the <code>tower</code> key as an object with the following values:</p>
<table class="markdownTable">
<tr class="markdownTableHead">
<th class="markdownTableHeadLeft">Field   </th><th class="markdownTableHeadLeft">Description    </th></tr>
<tr class="markdownTableRowOdd">
<td class="markdownTableBodyLeft"><code>mcc</code>   </td><td class="markdownTableBodyLeft">Mobile country code    </td></tr>
<tr class="markdownTableRowEven">
<td class="markdownTableBodyLeft"><code>mnc</code>   </td><td class="markdownTableBodyLeft">Mobile network code    </td></tr>
<tr class="markdownTableRowOdd">
<td class="markdownTableBodyLeft"><code>cid</code>   </td><td class="markdownTableBodyLeft">Cell identifier    </td></tr>
<tr class="markdownTableRowEven">
<td class="markdownTableBodyLeft"><code>lac</code>   </td><td class="markdownTableBodyLeft">Location area code   </td></tr>
</table>
<h3>logLevel (string)</h3>
<table class="markdownTable">
<tr class="markdownTableHead">
<th class="markdownTableHeadLeft">Constant   </th><th class="markdownTableHeadLeft">Configuration String    </th></tr>
<tr class="markdownTableRowOdd">
<td class="markdownTableBodyLeft"><code>LOG_LEVEL_ALL</code>   </td><td class="markdownTableBodyLeft"><code>ALL</code>    </td></tr>
<tr class="markdownTableRowEven">
<td class="markdownTableBodyLeft"><code>LOG_LEVEL_TRACE</code>   </td><td class="markdownTableBodyLeft"><code>TRACE</code>    </td></tr>
<tr class="markdownTableRowOdd">
<td class="markdownTableBodyLeft"><code>LOG_LEVEL_INFO</code>   </td><td class="markdownTableBodyLeft"><code>INFO</code>    </td></tr>
<tr class="markdownTableRowEven">
<td class="markdownTableBodyLeft"><code>LOG_LEVEL_WARN</code>   </td><td class="markdownTableBodyLeft"><code>WARN</code>    </td></tr>
<tr class="markdownTableRowOdd">
<td class="markdownTableBodyLeft"><code>LOG_LEVEL_ERROR</code>   </td><td class="markdownTableBodyLeft"><code>ERROR</code>    </td></tr>
<tr class="markdownTableRowEven">
<td class="markdownTableBodyLeft"><code>LOG_LEVEL_PANIC</code>   </td><td class="markdownTableBodyLeft"><code>PANIC</code>    </td></tr>
<tr class="markdownTableRowOdd">
<td class="markdownTableBodyLeft"><code>LOG_LEVEL_NONE</code>   </td><td class="markdownTableBodyLeft"><code>NONE</code>   </td></tr>
</table>
<h3>logFilters (object)</h3>
<p>This is a JSON representation of a logging configuration for <code>LogCategoryFilter</code>. It is an object whose key is the category and value is the logging level.</p>
<p>For example, given this code:</p>
<div class="fragment"><div class="line">SerialLogHandler logHandler(LOG_LEVEL_WARN, { <span class="comment">// Logging level for non-application messages</span></div>
<div class="line">    { <span class="stringliteral">&quot;app&quot;</span>, LOG_LEVEL_INFO }, <span class="comment">// Default logging level for all application messages</span></div>
<div class="line">    { <span class="stringliteral">&quot;app.network&quot;</span>, LOG_LEVEL_TRACE } <span class="comment">// Logging level for networking messages</span></div>
<div class="line">});</div>
</div><!-- fragment --><p>An equivalent JSON configuration would be:</p>
<div class="fragment"><div class="line">{</div>
<div class="line">    &quot;logLevel&quot;: &quot;LOG_LEVEL_WARN&quot;,</div>
<div class="line">    &quot;logFilters&quot;: {</div>
<div class="line">        &quot;app&quot;: &quot;INFO&quot;,</div>
<div class="line">        &quot;app.network&quot;: &quot;TRACE&quot;</div>
<div class="line">    }</div>
<div class="line">}</div>
</div><!-- fragment --><p>You can also configure log filters locally using the same style as Device OS log handlers:</p>
<div class="fragment"><div class="line"><a class="code hl_function" href="class_device_info_ledger.html#a42de8141c03aab313bde20c04c820fd5">DeviceInfoLedger::instance</a>().<a class="code hl_function" href="class_device_info_ledger.html#a0eb0a90933144ea84d5eb6ac5edb045a">withLocalConfigLogLevel</a>(LOG_LEVEL_INFO, {</div>
<div class="line">    { <span class="stringliteral">&quot;app.devinfo&quot;</span>, LOG_LEVEL_TRACE }</div>
<div class="line">});</div>
<div class="ttc" id="aclass_device_info_ledger_html_a0eb0a90933144ea84d5eb6ac5edb045a"><div class="ttname"><a href="class_device_info_ledger.html#a0eb0a90933144ea84d5eb6ac5edb045a">DeviceInfoLedger::withLocalConfigLogLevel</a></div><div class="ttdeci">DeviceInfoLedger &amp; withLocalConfigLogLevel(LogLevel level=LOG_LEVEL_INFO, LogCategoryFilters filters={})</div><div class="ttdoc">Set the local config log filters from a static array of LogCategoryFilter.</div><div class="ttdef"><b>Definition</b> DeviceInfoLedger.cpp:252</div></div>
<div class="ttc" id="aclass_device_info_ledger_html_a42de8141c03aab313bde20c04c820fd5"><div class="ttname"><a href="class_device_info_ledger.html#a42de8141c03aab313bde20c04c820fd5">DeviceInfoLedger::instance</a></div><div class="ttdeci">static DeviceInfoLedger &amp; instance()</div><div class="ttdoc">Gets the singleton instance of this class, allocating it if necessary.</div><div class="ttdef"><b>Definition</b> DeviceInfoLedger.cpp:106</div></div>
</div><!-- fragment --> </div></div><!-- PageDoc -->
<a href="doxygen_crawl.html"/>
</div><!-- contents -->
<!-- start footer part -->
<hr class="footer"/><address class="footer"><small>
Generated by&#160;<a href="https://www.doxygen.org/index.html"><img class="footer" src="doxygen.svg" width="104" height="31" alt="doxygen"/></a> 1.10.0
</small></address>
</body>
</html>
